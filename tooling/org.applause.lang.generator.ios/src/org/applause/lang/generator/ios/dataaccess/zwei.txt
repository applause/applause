#import \"Person+DataAccess.h\"\n#import \"PersonAPIClient.h\"\n#import \"Person+DataMapping.h\"\n\nstatic NSString *const kAllPersonsPath = @\"/persons\";\nstatic NSString *const kPostPersonPath = @\"/persons\";\nstatic NSString *const kPutPersonPath = @\"/persons\";\nstatic NSString *const kDeletePersonPath = @\"/persons/%@\";\n\n@implementation Person (DataAccess)\n\n+ (void)allPersons:(void (^)(NSArray *persons, NSError *error))block\n{\n\t[[PersonAPIClient sharedClient] GET:kAllPersonsPath parameters:nil success:^(NSURLSessionDataTask *task, id responseObject)\n\t{\n\t\tNSArray *elementsFromJSON = responseObject;\n\t\tNSMutableArray *result = [[NSMutableArray alloc] initWithCapacity:[elementsFromJSON count]];\n\t\tfor (NSDictionary *attributes in elementsFromJSON) {\n\t\t\tPerson *mappedElement = [[Person alloc] initWithAttributes:attributes];\n\t\t\t[result addObject:mappedElement];\n\t\t}\n\n\t\tif (block) {\n\t\t\tblock([result copy], nil);\n\t\t}\n\t} failure:^(NSURLSessionDataTask *task, NSError *error)\n\t{\n\t\tif (block) {\n\t\t\tblock(@[], error);\n\t\t}\n\t}];\n}\n\n- (void)post:(void (^)(Person *person, NSError *error))block\n{\n\tNSDictionary *elementDictionary = [self attributes];\n\t[[PersonAPIClient sharedClient] POST:kPostPersonPath parameters:elementDictionary success:^(NSURLSessionDataTask *task, id responseObject)\n\t{\n\t\tPerson *postedElement = responseObject;\n\t\tif(block) {\n\t\t\tblock(postedElement, nil);\n\t\t}\n\t} failure:^(NSURLSessionDataTask *task, NSError *error)\n\t{\n\t\tif(block) {\n\t\t\tblock(nil, error);\n\t\t}\n\t}];\n}\n\n- (void)put:(void (^)(Person *person, NSError *error))block\n{\n\tNSDictionary *elementDictionary = [self attributes];\n\t[[PersonAPIClient sharedClient] PUT:kPutPersonPath parameters:elementDictionary success:^(NSURLSessionDataTask *task, id responseObject)\n\t{\n\t\tPerson *postedElement = responseObject;\n\t\tif(block) {\n\t\t\tblock(postedElement, nil);\n\t\t}\n\t} failure:^(NSURLSessionDataTask *task, NSError *error)\n\t{\n\t\tif(block) {\n\t\t\tblock(nil, error);\n\t\t}\n\t}];\n}\n\n- (void)remove:(void (^)(Person *personNSError *error))block\n{\n\tNSString *urlString = [NSString stringWithFormat:kDeletePersonPath, self.id];\n\t[[PersonAPIClient sharedClient] DELETE:urlString parameters:nil success:^(NSURLSessionDataTask *task, id responseObject)\n\t{\n\t\tif(block) {\n\t\t\tblock(self, nil);\n\t\t}\n\t} failure:^(NSURLSessionDataTask *task, NSError *error)\n\t{\n\t\tif(block) {\n\t\t\tblock(nil, error);\n\t\t}\n\t}];\n}\n\n@end\n"
